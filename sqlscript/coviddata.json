{
	"name": "coviddata",
	"properties": {
		"content": {
			"query": "-- This is auto-generated code\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'https://accsynapsestorage.dfs.core.windows.net/coviddata/covid_19_data.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION='2.0',\n        FIRSTROW = 2\n    ) AS [result]\n\nCREATE DATABASE coviddb;\n\nCREATE VIEW covidview AS\nSELECT\n    *\nFROM\n    OPENROWSET(\n        BULK 'https://accsynapsestorage.dfs.core.windows.net/coviddata/covid_19_data.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION='2.0',\n        DATA_SOURCE = 'SqlOnDemandDemo',\n        FIRSTROW = 2\n    ) WITH (\n      SNo int,\n      ObservationDate varchar(50),\n      ProvinceState varchar(200),\n      CountryRegion varchar(200),\n      LastUpdate varchar(50),\n      Confirmed decimal(18,2),\n      Deaths decimal(18,2),\n      Recovered decimal(18,2)\n) AS [result]\n\nuse coviddb\nGO\n\nuse coviddb\nCREATE MASTER KEY ENCRYPTION BY PASSWORD = 'xyxpojklnbgtyughd234!234$%';\n-- create credentials for containers in our demo storage account\nCREATE DATABASE SCOPED CREDENTIAL sqlondemand\nWITH IDENTITY='SHARED ACCESS SIGNATURE',  \nSECRET = '?sv=2019-12-12&ss=bfqt&srt=sco&sp=rwdlacupx&se=2021-10-08T20:03:10Z&st=2020-10-08T12:03:10Z&spr=https&sig=73FwbAOqT3VI6SQ%2FjX1E0CQDo0y7Sri8%2FdAdgOnGE8w%3D'\nGO\nCREATE EXTERNAL DATA SOURCE SqlOnDemandDemo WITH (\n    LOCATION = 'https://accsynapsestorage.blob.core.windows.net',\n    CREDENTIAL = sqlondemand\n);\n\n\nDROP VIEW IF EXISTS covidview;\nGO\n\nCREATE VIEW covidview AS\nSELECT\n    *\nFROM\n    OPENROWSET(\n        BULK 'coviddata/covid_19_data.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION='2.0',\n        DATA_SOURCE = 'SqlOnDemandDemo',\n        FIRSTROW = 2\n    ) WITH (\n      SNo int,\n      ObservationDate varchar(50),\n      ProvinceState varchar(200),\n      CountryRegion varchar(200),\n      LastUpdate varchar(50),\n      Confirmed decimal(18,2),\n      Deaths decimal(18,2),\n      Recovered decimal(18,2)\n) AS [result]\n\nselect top 200 * from covidview;\n\nselect count(*) from covidview;\n\nSelect CountryRegion, sum(Confirmed) as Confirmed, sum(Deaths) as Deaths, sum(Recovered) as Recovered\n from covidview \ngroup by CountryRegion\n\nSelect datepart(YEAR, ObservationDate) as year, datepart(MONTH, ObservationDate) as month, \nCountryRegion, \nsum(Confirmed) as Confirmed, sum(Deaths) as Deaths, sum(Recovered) as Recovered\n from covidview \ngroup by datepart(YEAR, ObservationDate), datepart(MONTH, ObservationDate),CountryRegion\n\n-- create a container called covidoutput in blob or adls container.\nCREATE EXTERNAL DATA SOURCE mycovidioutput WITH (\n    LOCATION = 'https://accsynapsestorage.blob.core.windows.net/covidoutput', CREDENTIAL = sqlondemand\n);\nGO\n\nCREATE EXTERNAL FILE FORMAT [ParquetFF] WITH (\n    FORMAT_TYPE = PARQUET,\n    DATA_COMPRESSION = 'org.apache.hadoop.io.compress.SnappyCodec'\n);\nGO\n\nDrop external table covidaggrCETAS;\n\nCREATE EXTERNAL TABLE [dbo].[covidaggrCETAS] WITH (\n        LOCATION = 'covidParquet/',\n        DATA_SOURCE = [mycovidioutput],\n        FILE_FORMAT = [ParquetFF]\n) AS\nSELECT\n    *\nFROM\n    OPENROWSET(\n        BULK 'coviddata/covid_19_data.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION='2.0',\n        DATA_SOURCE = 'SqlOnDemandDemo',\n        FIRSTROW = 2\n    ) WITH (\n      SNo int,\n      ObservationDate varchar(50),\n      ProvinceState varchar(200),\n      CountryRegion varchar(200),\n      LastUpdate varchar(50),\n      Confirmed decimal(18,2),\n      Deaths decimal(18,2),\n      Recovered decimal(18,2)\n) AS [result];\n\nCREATE EXTERNAL TABLE [dbo].[covidaggrCETAS] WITH (\n        LOCATION = 'covidAggr/',\n        DATA_SOURCE = [mycovidioutput],\n        FILE_FORMAT = [ParquetFF]\n) AS\nSelect datepart(YEAR, ObservationDate) as year, datepart(MONTH, ObservationDate) as month, \nCountryRegion, \nsum(Confirmed) as Confirmed, sum(Deaths) as Deaths, sum(Recovered) as Recovered\n from covidview \ngroup by datepart(YEAR, ObservationDate), datepart(MONTH, ObservationDate),CountryRegion;\n\nUSE [coviddb];\nGO\n\nSELECT\n    *\nFROM covidaggrCETAS;",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"name": "coviddb",
				"type": "SqlOnDemand"
			}
		},
		"type": "SqlQuery"
	}
}
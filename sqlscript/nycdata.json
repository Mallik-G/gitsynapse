{
	"name": "nycdata",
	"properties": {
		"content": {
			"query": "-- type your sql script here, we now have intellisense\nCreate database nyctaxi;\n\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK     'https://azureopendatastorage.blob.core.windows.net/nyctlc/yellow/puYear=*/puMonth=*/*.parquet',\n        FORMAT = 'parquet'\n    ) AS [result];\n\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK     'https://azureopendatastorage.blob.core.windows.net/nyctlc/green/puYear=*/puMonth=*/*.parquet',\n        FORMAT = 'parquet'\n    ) AS [result];\n\nuse nyctaxi;\nGO\n\nuse nyctaxi\nCREATE MASTER KEY ENCRYPTION BY PASSWORD = 'xyxpojklnbgtyughd234!234$%';\n-- create credentials for containers in our demo storage account\nuse nyctaxi\nCREATE DATABASE SCOPED CREDENTIAL sqlondemand\nWITH IDENTITY='SHARED ACCESS SIGNATURE',  \nSECRET = '?sv=2019-12-12&ss=bfqt&srt=sco&sp=rwdlacupx&se=2021-10-08T20:03:10Z&st=2020-10-08T12:03:10Z&spr=https&sig=73FwbAOqT3VI6SQ%2FjX1E0CQDo0y7Sri8%2FdAdgOnGE8w%3D'\nGO\n\nuse nyctaxi\nCREATE EXTERNAL DATA SOURCE SqlOnDemandDemo1 WITH (\n    LOCATION = 'https://accsynapsestorage.blob.core.windows.net',\n    CREDENTIAL = sqlondemand\n);\n\nuse nyctaxi\n-- create a container called covidoutput in blob or adls container.\nCREATE EXTERNAL DATA SOURCE mycovidioutputyellow WITH (\n    LOCATION = 'https://accsynapsestorage.blob.core.windows.net/nyctaxiyellow', CREDENTIAL = sqlondemand\n);\nGO\n\nCREATE EXTERNAL DATA SOURCE mycovidioutputgreen WITH (\n    LOCATION = 'https://accsynapsestorage.blob.core.windows.net/nyctaxigreen', CREDENTIAL = sqlondemand\n);\nGO\n\nuse nyctaxi\nCREATE EXTERNAL FILE FORMAT [ParquetFF] WITH (\n    FORMAT_TYPE = PARQUET,\n    DATA_COMPRESSION = 'org.apache.hadoop.io.compress.SnappyCodec'\n);\nGO\n\nuse nyctaxi\nCREATE EXTERNAL TABLE [dbo].[nycyellow] WITH (\n        LOCATION = 'nyctaxiyellow/',\n        DATA_SOURCE = [mycovidioutputyellow],\n        FILE_FORMAT = [ParquetFF]\n) AS\nSELECT\n    *\nFROM\n    OPENROWSET(\n        BULK     'https://azureopendatastorage.blob.core.windows.net/nyctlc/yellow/puYear=*/puMonth=*/*.parquet',\n        FORMAT = 'parquet'\n    ) AS [result];\n\n\nuse nyctaxi\nCREATE EXTERNAL TABLE [dbo].[nycgreen] WITH (\n        LOCATION = 'nyctaxigreen/',\n        DATA_SOURCE = [mycovidioutputgreen],\n        FILE_FORMAT = [ParquetFF]\n) AS\nSELECT\n    *\nFROM\n    OPENROWSET(\n        BULK     'https://azureopendatastorage.blob.core.windows.net/nyctlc/green/puYear=*/puMonth=*/*.parquet',\n        FORMAT = 'parquet'\n    ) AS [result];\n\n\n\nuse nyctaxi;\nGO\n\n\n\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK     'https://accsynapsestorage.blob.core.windows.net/synapseroot/nyctaxiyellow/*',\n        FORMAT = 'parquet'\n    ) AS [result];\n\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK     'https://accsynapsestorage.blob.core.windows.net/synapseroot/nyctaxigreen/*',\n        FORMAT = 'parquet'\n    ) AS [result];\n\n\nSELECT\n    count(*)\nFROM\n    OPENROWSET(\n        BULK     'https://accsynapsestorage.blob.core.windows.net/synapseroot/nyctaxiyellow/*',\n        FORMAT = 'parquet'\n    ) AS [result];\n\n\n\nSELECT\n    count(*)\nFROM\n    OPENROWSET(\n        BULK     'https://accsynapsestorage.blob.core.windows.net/synapseroot/nyctaxigreen/*',\n        FORMAT = 'parquet'\n    ) AS [result];\n\nSELECT\n    Top 2000 *\nFROM\n    OPENROWSET(\n        BULK     'https://accsynapsestorage.blob.core.windows.net/synapseroot/nyctaxiyellow/*',\n        FORMAT = 'parquet'\n    ) AS [result];\n\nSELECT\n    PuYear, PuMonth, sum(FareAmount) as FareAmount, sum(TotalAmount) as TotalAmount\nFROM\n    OPENROWSET(\n        BULK     'https://accsynapsestorage.blob.core.windows.net/synapseroot/nyctaxiyellow/*',\n        FORMAT = 'parquet'\n    ) AS [result] \n    Group by PuYear, PuMonth\n    Order by PuYear, PuMonth;\n\nSELECT\n    Top 10000 *\nFROM\n    OPENROWSET(\n        BULK     'https://accsynapsestorage.blob.core.windows.net/synapseroot/nyctaxiyellow/*',\n        FORMAT = 'parquet'\n    ) AS [result];\n\n\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK     'https://accsynapsestorage.blob.core.windows.net/synapseroot/nyctaxiyellow/*',\n        FORMAT = 'parquet'\n    ) AS [result];\n\nSELECT\n    distinct VendorID\nFROM\n    OPENROWSET(\n        BULK     'https://accsynapsestorage.blob.core.windows.net/synapseroot/nyctaxiyellow/*',\n        FORMAT = 'parquet'\n    ) AS [result];\n\nSELECT\n    distinct PaymentType\nFROM\n    OPENROWSET(\n        BULK     'https://accsynapsestorage.blob.core.windows.net/synapseroot/nyctaxiyellow/*',\n        FORMAT = 'parquet'\n    ) AS [result];\n\n\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK     'https://azureopendatastorage.blob.core.windows.net/censusdatacontainer/release/us_population_county/year=*/*.parquet',\n        FORMAT = 'parquet'\n    ) AS [result];\n\n\nuse nyctaxi\nDROP EXTERNAL DATA SOURCE uspopulation;\n\nuse nyctaxi\nCREATE EXTERNAL DATA SOURCE myuspopulation WITH (\n    LOCATION = 'https://accsynapsestorage.blob.core.windows.net/uspopulation', CREDENTIAL = sqlondemand\n);\nGO\n\nuse nyctaxi\nDROP EXTERNAL TABLE [dbo].[factpopulation];\n\nuse nyctaxi\nCREATE EXTERNAL TABLE [dbo].[factpopulation] WITH (\n        LOCATION = 'fact/',\n        DATA_SOURCE = [myuspopulation],\n        FILE_FORMAT = [ParquetFF]\n) AS\nSELECT\n    *\nFROM\n    OPENROWSET(\n        BULK     'https://azureopendatastorage.blob.core.windows.net/censusdatacontainer/release/us_population_county/year=*/*.parquet',\n        FORMAT = 'parquet'\n    ) AS [result];\n\n\nselect \n top 100 * \nuspopulation\n\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK     'https://accsynapsestorage.blob.core.windows.net/uspopulation/fact/*',\n        FORMAT = 'parquet'\n    ) AS [result];\n\n\nuse nyctaxi\nselect top 200 * from dbo.factpopulation;\n\nSELECT\n    StateName, CountyName, \n    Race, Sex,\n    sum(Population) as Population, \n    Avg(MinAge) as MinAge, \n    Max(MaxAge) as MaxAge\nFROM\n    dbo.factpopulation\n    Group by StateName, CountyName, Race, Sex\n    Order by StateName, CountyName, Race, Sex;\n\n\nSelect distinct StateName from dbo.factpopulation;\n\nCREATE EXTERNAL TABLE [dbo].[dimstate] WITH (\n        LOCATION = 'dimstate/',\n        DATA_SOURCE = [myuspopulation],\n        FILE_FORMAT = [ParquetFF]\n) AS\nSelect distinct StateName from dbo.factpopulation\n\nselect * from dbo.dimstate;\n\nCREATE EXTERNAL TABLE [dbo].[dimcountyname] WITH (\n        LOCATION = 'dimcountryname/',\n        DATA_SOURCE = [myuspopulation],\n        FILE_FORMAT = [ParquetFF]\n) AS\nSelect distinct CountyName from dbo.factpopulation\n\nCREATE EXTERNAL TABLE [dbo].[dimRace] WITH (\n        LOCATION = 'dimRace/',\n        DATA_SOURCE = [myuspopulation],\n        FILE_FORMAT = [ParquetFF]\n) AS\nSelect distinct Race from dbo.factpopulation\n\nCREATE EXTERNAL TABLE [dbo].[dimSex] WITH (\n        LOCATION = 'dimsex/',\n        DATA_SOURCE = [myuspopulation],\n        FILE_FORMAT = [ParquetFF]\n) AS\nSelect distinct Sex from dbo.factpopulation\n\nSelect * from dbo.dimstate\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"name": "nyctaxi",
				"type": "SqlOnDemand"
			}
		},
		"type": "SqlQuery"
	}
}